# Инструкция по обновлению бота (добавление функции /finance)

## Что было добавлено

Новая команда `/finance` для получения персонализированных финансовых рекомендаций на основе AI.

## Шаги для обновления

### 1. Обновление базы данных

Если у вас уже есть работающая база данных, выполните миграцию:

```bash
# Подключитесь к PostgreSQL и выполните
psql -U your_username -d your_database_name -f migrate_add_business_info.sql
```

Или можно добавить поле вручную:
```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS business_info TEXT;
```

**Примечание**: Если вы запускаете бота с нуля, миграция не требуется - поле будет создано автоматически.

### 2. Перезапуск бота

Остановите текущий процесс бота и запустите заново:

```bash
# Остановить бота (если запущен)
# Ctrl+C или найдите процесс и убейте его

# Активировать виртуальное окружение
source venv/bin/activate

# Запустить бота
python bot.py
```

Или используйте скрипт:
```bash
./run_bot.sh
```

### 3. Проверка работы

В Telegram отправьте боту:
- `/help` - должна появиться команда `/finance` в списке
- `/finance` - должен начаться интерактивный опрос

## Проверочный список

- [ ] База данных обновлена (поле `business_info` добавлено)
- [ ] Бот перезапущен
- [ ] Команда `/finance` доступна
- [ ] Интерактивный опрос работает
- [ ] Генерация плана работает
- [ ] Повторный вызов `/finance` предлагает обновить данные

## Возможные проблемы

### Ошибка "column business_info does not exist"
**Решение**: Выполните миграцию БД (шаг 1)

### Бот не отвечает на /finance
**Решение**: 
1. Проверьте логи бота
2. Убедитесь что бот перезапущен
3. Проверьте что все файлы обновлены

### Ошибка при генерации плана
**Решение**: 
1. Проверьте баланс токенов (нужно 3 токена)
2. Проверьте API ключ OpenRouter
3. Проверьте логи на наличие ошибок API

## Файлы для проверки

Убедитесь что следующие файлы обновлены:
- `schema.sql`
- `database.py`
- `user_manager.py`
- `ai_client.py`
- `constants.py`
- `bot.py`

## Откат изменений (если что-то пошло не так)

Если нужно откатить изменения:

```bash
# Откатить изменения в Git
git checkout HEAD -- bot.py database.py user_manager.py ai_client.py constants.py schema.sql

# Удалить поле из БД (опционально)
psql -U your_username -d your_database_name -c "ALTER TABLE users DROP COLUMN IF EXISTS business_info;"
```

## Дополнительная информация

Подробное описание функции см. в файле `FINANCE_FEATURE.md`


